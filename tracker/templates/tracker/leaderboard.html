{% extends "base.html" %}
{% block content %}
<div class="container mx-auto p-4 md:p-6">
    <div class="text-center mb-8">
        <h2 class="text-4xl font-extrabold text-white tracking-tight">üèÜ Carbon Champions</h2>
        <p class="text-slate-400 mt-2">See who's leading the way in reducing their carbon footprint!</p>
    </div>

    {% if top_users %}

    <!-- Top 3 Podium -->
    <div class="flex justify-center items-end gap-4 mb-12">
        <!-- 2nd Place -->
        {% if top_users|length > 1 %}
        <div class="text-center w-1/4">
            <div class="p-6 bg-gradient-to-br from-slate-600 to-slate-700 rounded-t-xl border-4 border-slate-500 shadow-lg">
                <div class="text-5xl mb-2">ü•à</div>
                <div class="w-20 h-20 bg-slate-500 rounded-full mx-auto flex items-center justify-center text-2xl font-bold text-white mb-3 ring-4 ring-slate-400">
                    {{ top_users.1.user.username|first|upper }}
                </div>
                <h3 class="font-bold text-white truncate">{{ top_users.1.user.username }}</h3>
                <p class="text-amber-300 font-semibold">{{ top_users.1.total_co2|floatformat:2 }} kg CO‚ÇÇ</p>
            </div>
        </div>
        {% endif %}

        <!-- 1st Place -->
        <div class="text-center w-1/3">
            <div class="p-8 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-t-xl border-4 border-amber-300 shadow-2xl relative">
                <div class="text-6xl mb-3">ü•á</div>
                <div class="w-24 h-24 bg-amber-200 rounded-full mx-auto flex items-center justify-center text-3xl font-bold text-amber-800 mb-3 ring-4 ring-white">
                    {{ top_users.0.user.username|first|upper }}
                </div>
                <h3 class="font-bold text-2xl text-white truncate">{{ top_users.0.user.username }}</h3>
                <p class="text-white font-bold text-lg">{{ top_users.0.total_co2|floatformat:2 }} kg CO‚ÇÇ</p>
            </div>
        </div>

        <!-- 3rd Place -->
        {% if top_users|length > 2 %}
        <div class="text-center w-1/4">
            <div class="p-6 bg-gradient-to-br from-orange-500 to-yellow-600 rounded-t-xl border-4 border-orange-400 shadow-lg">
                <div class="text-5xl mb-2">ü•â</div>
                <div class="w-20 h-20 bg-yellow-700 rounded-full mx-auto flex items-center justify-center text-2xl font-bold text-white mb-3 ring-4 ring-orange-300">
                    {{ top_users.2.user.username|first|upper }}
                </div>
                <h3 class="font-bold text-white truncate">{{ top_users.2.user.username }}</h3>
                <p class="text-yellow-200 font-semibold">{{ top_users.2.total_co2|floatformat:2 }} kg CO‚ÇÇ</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Ranks 4+ -->
    <div class="space-y-2">
        {% for user_rank in top_users %}
            {% if forloop.counter > 3 %}
            
            <!-- ######## FIX IS HERE ######## -->
            
            <div class="flex items-center p-4 rounded-lg transition-all duration-300
                        {% if user_rank.user == request.user %}
                            bg-green-600/30 border-l-4 border-green-400 shadow-md
                        {% else %}
                            bg-slate-800 hover:bg-slate-700/50
                        {% endif %}">
                <div class="w-12 text-center text-slate-400 font-bold text-lg">{{ forloop.counter }}</div>
                <div class="flex items-center gap-4 flex-grow">
                    <div class="w-10 h-10 bg-slate-600 rounded-full flex items-center justify-center text-md font-bold text-white">
                        {{ user_rank.user.username|first|upper }}
                    </div>
                    <span class="font-medium text-white">{{ user_rank.user.username }}</span>
                    
                    {% if user_rank.user == request.user %}
                    <span class="text-xs bg-green-500 text-white font-bold py-0.5 px-2 rounded-full">YOU</span>
                    {% endif %}
                </div>
                <div class="font-semibold text-green-400 text-right">{{ user_rank.total_co2|floatformat:2 }} kg CO‚ÇÇ</div>
            </div>
            <!-- ######## END OF FIX ######## -->
            
            {% endif %}
        {% endfor %}
    </div>

    {% else %}
    <div class="text-center py-12">
        <p class="text-slate-400">The leaderboard is empty right now. Be the first to the top!</p>
    </div>
    {% endif %}

</div>
{% endblock %}